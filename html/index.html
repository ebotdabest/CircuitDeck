<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>WebCards</title>
    <meta name="description" content="A project to make cards." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="{{ get_serverside_file('css', 'style.css') }}"
    />
  </head>
  <body>
    {{ add_signals() }}

    <script type="module" defer>
      import { send_to_server } from "/scripts/signals.js";
      import { makeCards } from "/scripts/scripts.js";
      import { makeNodes } from "/scripts/scripts.js";

      document.body.addEventListener("serverOpen", () => {
        send_to_server("/api/refresh_computers", {}, () => {});
      });
      document.body.addEventListener("serverMessage", (e) => {
        const command = JSON.parse(e.detail.message);
        switch (command.type) {
          case "addComputer":
            const clone = document.querySelector("#copy").cloneNode(true);
            document.querySelectorAll(".container")[0].appendChild(clone);

            for (const e of clone.children) {
              const name = e.getAttribute("name");
              if (name === "name") {
                e.innerText = command.name;
              } else if (name === "proc") {
                e.innerText = `Processor: ${command.proc}`;
              } else if (name === "mem") {
                e.innerText = `Memory: ${command.mem}`;
              }
            }
            clone.hidden = false;
            makeCards();
            makeNodes();
            break;
          case "registerProcess":
            const clone2 = document
              .querySelector("#copy-process")
              .cloneNode(true);
            document.querySelectorAll(".items-app")[0].appendChild(clone2);
            clone2.classList.add("duplicateable-app");
            clone2.hidden = false;
            for (const e of clone2.children) {
              const name = e.getAttribute("name");
              if (name === "name") {
                e.innerText = command.name;
              } else if (name === "mem") {
                e.innerText = command.mem;
              } else if (name === "proc") {
                e.innerText = command.proc;
              }
            }
            break;
        }
      });
    </script>
    <div id="workspaces-wrap">
      <div id="workspace-create-ui">
        <h2>Create workspace</h2>
        <form id="workspace-form">
          <p>Name</p>
          <input type="text" name="workspace-name" id="workspace-name" />
          <button type="submit" id="workspace-create-button">Create</button>
        </form>
      </div>
      <button type="button" id="remove-workspace">Delete</button>
      <div id="workspaces">
        <button type="button" class="workspace" id="Base">Base</button>
      </div>
      <button type="button" id="add-workspace">+</button>
    </div>
    <div hidden class="card" id="copy">
      <h2 name="name">Card 69</h2>
      <p name="proc">Drag me!</p>
      <p name="mem">Drag me!</p>
      <div id="process-holder">
        <div hidden id="copy-process">
          <img
            src="{{ get_serverside_file('content', 'google_logo.png') }}"
            alt="VSCodelogo"
          />
          <h2 name="name">Google</h2>
          <p class="memory" name="mem">Memory used:</p>
          <p class="cpu" name="proc">CPU used:</p>
          <button class="settings">⚙️</button>
        </div>
      </div>
    </div>

    <div class="container 1">
      <div class="card" id="copy">
        <h2 name="name">Card 69</h2>
        <p name="proc">Drag me!</p>
        <p name="mem">Drag me!</p>
        <div id="process-holder">
          <div id="copy-process" class="node2 inside">
            <img
              src="{{ get_serverside_file('content', 'google_logo.png') }}"
              alt="VSCodelogo"
            />
            <h2 name="name">Google</h2>
            <p class="memory" name="mem">Memory used:</p>
            <p class="cpu" name="proc">CPU used:</p>
            <button class="settings">⚙️</button>
          </div>
        </div>
      </div>
    </div>
    <div class="menu">
      <button id="menu-button">◀</button>
      <button id="button-pc" type="button">Create PC</button>
      <div class="items-pc">
        <div class="duplicateable-pc">
          <h2>Card to clone!</h2>
          <p>Click me to clone!</p>
        </div>
        <div class="duplicateable-pc">
          <h2>Card 2 clone!</h2>
          <p>Click me too!</p>
          <button>Sample button</button>
        </div>
        <div class="duplicateable-pc">
          <h2>Card to clone!</h2>
          <p>Click me to clone!</p>
        </div>
        <div class="duplicateable-pc">
          <h2>Card 2 clone!</h2>
          <p>Click me too!</p>
          <button>Sample button</button>
        </div>
      </div>
      <div class="items-app"></div>
    </div>
    <div id="delete-box">
      <img
        src="{{ get_serverside_file('content', 'trashcan.png') }}"
        alt="Trashcan"
      />
    </div>
    <div id="pc-create-ui">
      <h2>Create PC</h2>
      <p>Name</p>
      <input type="text" name="pcname" id="pc-name" />
      <p>Memory: <span id="memory-value">1</span></p>
      <input type="range" min="1" max="131072" id="memory-slider" />
      <p>Cores: <span id="cores-value">2</span></p>
      <input type="range" min="2" max="96" step="2" id="cores-slider" />
    </div>
    <script
      type="module"
      src="{{ get_serverside_file('scripts', 'scripts.js') }}"
      defer
    ></script>
    <script defer>
      document.querySelectorAll(".node2").forEach((e) => {
        const handleEv = (ev) => {
          e.classList.remove("node2");
          e.classList.remove("inside");
          document.querySelectorAll(".container")[0].appendChild(e);
          e.classList.add("node");
          const clientX = ev.touchevs ? ev.touches[0].clientX : ev.clientX;
          const clientY = ev.touches ? ev.touches[0].clientY : ev.clientY;
          const x = clientX;
          const y = clientY;
          e.style.left = x + "px";
          e.style.top = y + "px";
          makeNodes();
          e.removeEventListener("click", handleEv);
        };
        e.addEventListener("click", handleEv);
      });
    </script>
  </body>
</html>
